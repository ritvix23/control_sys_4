The feedback current amplifier in Fig \ref{fig:ee18btech11038_probfig} utilizes two identical NMOS transistor sized so that at $I_{D1} = 0.2mA$, they operate at $V_{OV} = 0.2V$. Both the devices have $V_{t} =0.5V$ and $V_{A} = 10V$.




a) If $I_{S}$ has zero DC component, show that both $Q_{1}$ and $Q_{2}$ are, operating at $I_{D} = 0.2mA$. What is DC voltage at the input?
\\
b)Find $g_{m}$ and $r_{o}$ for each $Q_{1}$ and $Q_{2}$.
\\
c) Find the open loop circuit and the value of $R_{i}$, $G$ and $R_{o}$.
\\
d) Find the value of $H$.
\\
e) Find $GH$ and $T$
\\
f)Find $R_{in}$ and $R_{out}$.
\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\begin{figure}[!ht]
	\begin{center}
		
		\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11038_prfig.tex}}
	\end{center}
\caption{Problem Figure}
\label{fig:ee18btech11038_probfig}
\end{figure}

\begin{table}[!ht]
\centering
\input{./tables/ee18btech11038_given.tex}
\caption{Given Parameters}
\label{table: given}
\end{table}

\begin{enumerate}[label=\arabic*.,ref=\theenumi]
\numberwithin{equation}{enumi}
\renewcommand{\thefigure}{\theenumi.\arabic{figure}}
\item a)DC analysis of circuit.\\
\solution Given that $I_{s}$ has zero DC component, it can be neglected in DC analysis of the circuit. The current does not enter the Gate terminal of any mosfet. Thus the DC current flow looks like shown in Fig \ref{fig:ee18btech11038_dcckt} 

\begin{figure}[!ht]
	\begin{center}
		
		\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11038_dcckt.tex}}
	\end{center}
\caption{DC Analysis Circuit}
\label{fig:ee18btech11038_dcckt}
\end{figure}

Given $V_{OV} = 0.2V$ and  $V_{t} = 0.5V$, for Q1-
\begin{align}
    V_{GS1} = V_{OV}  + V_{t} = 0.7V\\
    \implies V_{G1} = V_{GS1} = 0.7V
    \end{align}
\begin{align}
    \text{The DC voltage } V_{G1} = V_{S2}\\
    \text{by ohms law, } I_{D2} = \frac{V_{S2}}{R{1}} = \frac{0.7V}{3.5k\ohm}\\
    \implies I_{D2} = 0.2mA
\end{align}
Clearly $I_{D1} = 0.2mA$.
\\
DC voltage at input = $V_{G1} = 0.7V$

\item Verify the DC values $I_{D2}$ and $V_{G1}$.\\
\solution Simulate the circuit, Fig \ref{fig:ee18btech11038_dcckt}, using spice. Observe the DC operating point values. Fig \ref{fig:ee18btech11038_dc} shows that $I_{D2}$ is close to 0.2mA and $V_{G1}$ is close to 0.7V.
You can find the netlist for the simulated circuit here:
\begin{lstlisting}
spice/ee18btech11038_dc.cir
\end{lstlisting}
You can find the python script used to generate the output here:
\begin{lstlisting}
spice/ee18btech11038_dc.py
\end{lstlisting}

\begin{figure}[!ht]
\centering
\includegraphics[width=\columnwidth]{./figs/ee18btech11038_dc.eps}
\caption{Simulation for Verifying DC operating point}
\label{fig:ee18btech11038_dc}
\end{figure}


\item To find $g_{m}$ and $r_{o}$\\
\solution We know,
\begin{align}
    \text{transconductance, } g_{m} = \frac{2I_{D}}{V_{OV}} 
\end{align}
therefore-
\begin{align}
    g_{m1} = g_{m2} = \frac{(2)(0.2)(10^-3)}{0.2}\\
    \implies 2mA/V
\end{align}
$r_{o}$ is given by,
\begin{align}
    r_{0} = \frac{V_{A}}{I_{D}}\\
    \implies r_{o1} = r_{o2} = 50k\ohm
\end{align}

\item c) To find open loop circuit.\\
\solution The general open loop circuit for a current(series-shunt) amplifier is shown in Fig \ref{fig:ee18btech11038_genamp}.

\begin{figure}[!ht]
	\begin{center}
		
		\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11038_genamp.tex}}
	\end{center}
\caption{General open loop circuit}
\label{fig:ee18btech11038_genamp}
\end{figure}

\begin{table}[!ht]
\centering
\input{./tables/ee18btech11038_restable.tex}
\caption{Resistances}
\label{table: restable}
\end{table}

For our problem, the small circuit model is shown in Fig \ref{fig:ee18btech11038_smlckt}. All the different resistances are summarized in Table \ref{table: restable}

\begin{figure}[!ht]
	\begin{center}
		
		\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11038_smlckt.tex}}
	\end{center}
\caption{Small Circuit Model}
\label{fig:ee18btech11038_smlckt}
\end{figure}



For a shunt-series amplifier, $R_{11}$ is the resistance looking into the feedback circuit from port 1 while port 2 is open circuited.
\begin{align}
    R_{11} = R_{1} + R_{2}
\end{align}

$R_{22}$ is the resistance looking into the feedback circuit from port 2 while port 1 is short circuited.
\begin{align}
    R_{22} = R_{1}||R_{2}
\end{align}

Also for our problem, $R_{L} = 0$ and $R_{s} = \infty$.Open loop circuit for our problem is shown in Fig \ref{fig:ee18btech11038_Ackt}.
\begin{figure}[!ht]
	\begin{center}
		
		\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11038_Ackt.tex}}
	\end{center}
\caption{Open loop circuit}
\label{fig:ee18btech11038_Ackt}
\end{figure}

From the open loop circuit, Fig \ref{fig:ee18btech11038_Ackt}, we have-
\begin{align}
\label{eq:VG2}
    v_{g1} = I_{s}R_{11} = I_{s}(R_{1} + R_{2})\\
\label{eq:VG@}
    v_{g2} = -g_{m1}v_{g1}r_{o1}\\
    \implies g_{m1}r_{o1}(R_{1} + R_{2})I_{s}
\end{align}
KCL at node X yields -
\begin{align}
    g_{m2}(v_{g2} - v_{s2}) = \frac{v_{s2}}{r_{02}||R_{22}}\\ \\
    \implies g_{m2}v_{g2} = (g_{m2} + \frac{1}{r_{o2}||R_{22}})v_{s2}\\ \\
    \implies v_{s2} = \frac{v_{g2}g_{m2}}{g_{m2} + \frac{1}{r_{02}||R_{22}}}\\
\end{align}
therefore,
\begin{align}
    I_{o} = \frac{v_{s2}}{R_{22}}\\
    \implies \frac{v_{g2}g_{m2}}{g_{m2}(R_{1} + R_{2}) + \frac{R_{1}||R_{2}}{r_{o2}||R_{1}||R_{2}}}
\end{align}
Substituting $v_{g2}$ from \ref{eq:VG@},
\begin{align}
    I_{o} = \frac{-g_{m1}g_{m2}r_{o1}(R_{1} + R_{2})I_{s}}{g_{m2}(R_{1}||R_{2}) + \frac{R_{1}||R_{2}}{r_{o2}||R_{1}||R_{2}}}
\end{align}
Thus, open loop gain G- 
\begin{align}
    G = \frac{I_{o}}{I_{s}}\\
    \implies \frac{-g_{m1}g_{m2}r_{o1}(R_{1} + R_{2})}{g_{m2}(R_{1}||R_{2}) + \frac{R_{1}||R_{2}}{r_{o2}||R_{1}||R_{2}}}
\end{align}
\item Verify the open loop gain value($G$).\\
\solution Simulate the circuit, Fig \ref{fig:ee18btech11038_Ackt}, using spice. Pass small signal as input $I_{s}$ and observe the output. 
Fig \ref{fig:ee18btech11038_olgain} shows that $G = -525.76$ which is closed to that obtained in Table \ref{table: finalvalues}.
You can find the netlist for the simulated circuit here:
\begin{lstlisting}
spice/ee18btech11038_olgain.cir
\end{lstlisting}
You can find the python script used to generate the output here:
\begin{lstlisting}
spice/ee18btech11038_olgain.py
\end{lstlisting}

\begin{figure}[!ht]
\centering
\includegraphics[width=\columnwidth]{./figs/ee18btech11038_olgain.eps}
\caption{Simulation for Open loop gain}
\label{fig:ee18btech11038_olgain}
\end{figure}

\item c)Input Resistance for Open loop\\
\solution Input resistance of the Open loop, $R_{i}$, see Fig \ref{fig:ee18btech11038_Ackt}, clearly is-
\begin{align}
\label{eq:Ri}
    R_{i} = R_{1} + R_{2}
\end{align}
\item c) To find Output Resistance of Open loop, $R_{o}$\\
\solution See Fig \ref{fig:ee18btech11038_outckt} which is the output circuit obtained by breaking the open loop circuit, Fig \ref{fig:ee18btech11038_Ackt}, at YY` and setting the input to zero. $R_{o}$ is the resistance looking into YY`.

\begin{figure}[!ht]
	\begin{center}
		
		\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11038_outckt.tex}}
	\end{center}
\caption{Output Circuit}
\label{fig:ee18btech11038_outckt}
\end{figure}

The current source can be changed into an equivalent voltage source, and the circuit obtained is Fig \ref{fig:ee18btech11038_simpout}.
\begin{figure}[!ht]
	\begin{center}
		
		\resizebox{\columnwidth}{!}{\input{./figs/ee18btech11038_simpout.tex}}
	\end{center}
\caption{Simplified Output Circuit}
\label{fig:ee18btech11038_simpout}
\end{figure}

From circuit Fig \ref{fig:ee18btech11038_simpout}, we have,
\begin{align}
\label{eq:fsteqn}
    v_{gs2} = -I_{x}R_{22}\\
\label{eq:seceqn}
    v_{x} + g_{m2}v_{gs2}r_{o2} = I_{x}(r_{o2} + R_{22})
\end{align}
On subtituting \ref{eq:fsteqn} in \ref{eq:seceqn} and simplifying, we get,
\begin{align}
    \frac{v_{x}}{I_{x}} = r_{o2} + R_{22} + g_{m2}r_{o2}R_{22}\\
\label{eq:Ro}
    \implies R_{o} =r_{o2} + R_{1}||R_{2} + g_{m2}r_{o2}(R_{1}||R_{2})
\end{align}

\item Verify $R_{o}$ value.\\
\solution Simulate the circuit, Fig \ref{fig:ee18btech11038_outckt}, using spice. Sweep the DC input $V_{x}$ and observe output $I_{x}$. Fig \ref{fig:ee18btech11038_rout} shows that $R_{o} = Slope = 332.79k\Omega $ which is close to that obtained in Table \ref{table: finalvalues}.
You can find the netlist for the simulated circuit here:
\begin{lstlisting}
spice/ee18btech11038_rout.cir
\end{lstlisting}
You can find the python script used to generate the output here:
\begin{lstlisting}
spice/ee18btech11038_rout.py
\end{lstlisting}

\begin{figure}[!ht]
\centering
\includegraphics[width=\columnwidth]{./figs/ee18btech11038_rout.eps}
\caption{Simulation for verifying $R_{o}$}
\label{fig:ee18btech11038_rout}
\end{figure}


\item d) To find feedback gain, $H$\\
\solution We know,
\begin{align}
    H = \frac{I_{f}}{I_{0}}, \text{port1 shorted}\\
\end{align}
Therefore,
\begin{align}
    H = \frac{-R_{1}}{R_{1} + R_{2}}
\end{align}

\item e) To find closed-loop gain T\\
\solution 
\begin{align}
    GH = \frac{g_{m1}g_{m2}r_{o1}R_{1}}{g_{m2}(R_{1}||R_{2}) + \frac{R_{1}||R_{2}}{r_{o2}||R_{1}||R_{2}}}
\end{align}
We know, 
\begin{align}
    T = \frac{G}{1+GH}\\ \\
    \implies \frac{-g_{m1}g_{m2}r_{o1}(R_{1} + R_{2})}{g_{m2}(R_{1}||R_{2}) + \frac{R_{1}||R_{2}}{r_{o2}||R_{1}||R_{2}} +g_{m1}g_{m2}r_{o1}R_{1}}
\end{align}

\item Verify the Closed loop gain value.\\
\solution Simulate the circuit, Fig \ref{fig:ee18btech11038_probfig}, using spice. Pass small signal as input $I_{s}$ and observe the output. Fig \ref{fig:ee18btech11038_clgain} shows that $T=-4.96$ which is close to that obtained in Table \ref{table: finalvalues}.
You can find the netlist for the simulated circuit here:
\begin{lstlisting}
spice/ee18btech11038_clgain.cir
\end{lstlisting}
You can find the python script used to generate the output here:
\begin{lstlisting}
spice/ee18btech11038_clgain.py
\end{lstlisting}

\begin{figure}[!ht]
\centering
\includegraphics[width=\columnwidth]{./figs/ee18btech11038_clgain.eps}
\caption{Simulation for Closed Loop gain, $T$}
\label{fig:ee18btech11038_clgain}
\end{figure}


\item f) To find $R_{in}$ and $R_{out}$\\
\solution Since $R_{L} =0$ and $R_{s} =\infty$,
\begin{align}
    R_{in} = R_{if} =\frac{R_{i}}{1+GH}
\end{align}
and,
\begin{align}
    R_{out} = R_{of} = (1+GH)R_{o}
\end{align}
Refer \ref{eq:Ri} for $R_{i}$ and \ref{eq:Ro} for $R_{o}$.
Expressions are large for $R_{out}$ and $R_{in}$. Numerical values are calculated in Table \ref{table: finalvalues}.
\begin{table}[!ht]
\centering
\input{./tables/ee18btech11038_finalvalues.tex}
\caption{Numerical Values}
\label{table: finalvalues}
\end{table}

\end{enumerate}